<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mount View High School Management System</title>
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0046b8',
            secondary: '#4b83db',
            accent: '#e0eaff',
          }
        }
      }
    }
  </script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style id="app-style">
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f8ff;
    }
    
    .glassmorphic {
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
    }
    
    .float-card {
      transition: all 0.3s ease;
    }
    
    .float-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(31, 38, 135, 0.2);
    }
    
    .sidebar {
      transition: width 0.3s ease;
      width: 250px;
      min-width: 250px;
    }
    
    .sidebar.collapsed {
      width: 80px;
      min-width: 80px;
    }
    
    .content-area {
      transition: margin-left 0.3s ease;
    }
    
    .sidebar-link {
      border-radius: 8px;
      margin: 5px 10px;
      transition: all 0.2s ease;
    }
    
    .sidebar-link:hover, .sidebar-link.active {
      background-color: #0046b8;
      color: white;
    }
    
    .sidebar-link.active i {
      color: white;
    }
    
    .logo-text {
      transition: opacity 0.2s ease;
    }
    
    .sidebar.collapsed .logo-text, 
    .sidebar.collapsed .link-text {
      opacity: 0;
      display: none;
    }
    
    /* Loader */
    .loader {
      width: 48px;
      height: 48px;
      border: 5px solid #0046b8;
      border-bottom-color: transparent;
      border-radius: 50%;
      animation: rotation 1s linear infinite;
    }
    
    @keyframes rotation {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
    
    /* Toast notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 24px;
      border-radius: 8px;
      z-index: 9999;
      transform: translateY(-100px);
      transition: transform 0.3s ease;
    }
    
    .toast.show {
      transform: translateY(0);
    }
    
    /* Modal animations */
    .modal {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    
    .modal.show {
      opacity: 1;
      pointer-events: auto;
    }
    
    /* Table styles */
    table {
      border-collapse: separate;
      border-spacing: 0;
    }
    
    table th {
      background-color: #f1f5fd;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    table th:first-child {
      border-top-left-radius: 10px;
    }
    
    table th:last-child {
      border-top-right-radius: 10px;
    }
    
    table tr:last-child td:first-child {
      border-bottom-left-radius: 10px;
    }
    
    table tr:last-child td:last-child {
      border-bottom-right-radius: 10px;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #0046b8;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #003c9e;
    }
  </style>
</head>

<body class="h-screen flex flex-col">
  <!-- Toast Notifications -->
  <div id="successToast" class="toast bg-green-500 text-white shadow-lg hidden">
    <span id="successToastMessage">Operation successful!</span>
  </div>
  <div id="errorToast" class="toast bg-red-500 text-white shadow-lg hidden">
    <span id="errorToastMessage">An error occurred!</span>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="modal fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 show">
    <div class="glassmorphic p-8 w-full max-w-md">
      <div class="text-center mb-8">
        <h2 class="text-2xl font-bold text-primary">Mount View High School</h2>
        <p class="text-gray-600">Management System Login</p>
      </div>
      
      <form id="loginForm" class="space-y-6">
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
          <input type="email" id="email" name="email" value="admin@mountview.ac.ke" 
                 class="w-full px-4 py-2 border rounded-md focus:ring-primary focus:border-primary" required>
        </div>
        
        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
          <input type="password" id="password" name="password" value="admin123"
                 class="w-full px-4 py-2 border rounded-md focus:ring-primary focus:border-primary" required>
        </div>
        
        <div>
          <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
            <span id="loginBtnText">Sign In</span>
            <span id="loginBtnLoader" class="hidden ml-2">
              <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </span>
          </button>
        </div>
        
        <div id="loginError" class="text-red-500 text-center text-sm hidden">
          Invalid credentials. Please try again.
        </div>
      </form>
    </div>
  </div>

  <!-- Main App Container (Hidden until logged in) -->
  <div id="appContainer" class="h-full flex flex-col hidden">
    <!-- Top Navbar -->
    <nav class="bg-white shadow-md glassmorphic z-20">
      <div class="px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex">
            <div class="flex-shrink-0 flex items-center">
              <button id="sidebarToggle" class="mr-2 text-primary">
                <i class="fas fa-bars"></i>
              </button>
              <img class="h-10 w-auto" src="https://cdn.pixabay.com/photo/2016/11/07/13/04/yoga-1805784_960_720.png" alt="Mount View High School Logo">
              <span class="ml-2 text-xl font-bold text-primary">Mount View High School</span>
            </div>
          </div>
          <div class="flex items-center">
            <div class="flex-shrink-0">
              <span id="userFullName" class="mr-2 text-gray-700">Administrator</span>
              <span id="userRole" class="px-2 py-1 rounded-full text-xs bg-primary text-white">Admin</span>
            </div>
            <div class="ml-4 flex items-center">
              <button id="logoutBtn" class="flex items-center px-3 py-1 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-red-600 hover:bg-red-500 focus:outline-none focus:border-red-700 focus:shadow-outline-red transition duration-150 ease-in-out">
                <i class="fas fa-sign-out-alt mr-1"></i>
                Logout
              </button>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content Area -->
    <div class="flex flex-1 overflow-hidden">
      <!-- Sidebar -->
      <aside id="sidebar" class="sidebar bg-white glassmorphic shadow-md z-10 h-full">
        <nav class="mt-5 px-2">
          <a href="javascript:void(0)" class="sidebar-link active flex items-center px-4 py-3" data-section="dashboard">
            <i class="fas fa-tachometer-alt text-lg text-primary"></i>
            <span class="link-text ml-3">Dashboard</span>
          </a>
          <a href="javascript:void(0)" class="sidebar-link flex items-center px-4 py-3" data-section="students">
            <i class="fas fa-user-graduate text-lg text-primary"></i>
            <span class="link-text ml-3">Students</span>
          </a>
          <a href="javascript:void(0)" class="sidebar-link flex items-center px-4 py-3" data-section="classes">
            <i class="fas fa-chalkboard text-lg text-primary"></i>
            <span class="link-text ml-3">Classes</span>
          </a>
          <a href="javascript:void(0)" class="sidebar-link flex items-center px-4 py-3" data-section="billing">
            <i class="fas fa-file-invoice-dollar text-lg text-primary"></i>
            <span class="link-text ml-3">Billing</span>
          </a>
          <a href="javascript:void(0)" class="sidebar-link flex items-center px-4 py-3" data-section="reports">
            <i class="fas fa-chart-bar text-lg text-primary"></i>
            <span class="link-text ml-3">Reports</span>
          </a>
          <a href="javascript:void(0)" class="sidebar-link flex items-center px-4 py-3" data-section="notifications">
            <i class="fas fa-bell text-lg text-primary"></i>
            <span class="link-text ml-3">Notifications</span>
          </a>
          <a href="javascript:void(0)" class="sidebar-link flex items-center px-4 py-3" data-section="settings">
            <i class="fas fa-cog text-lg text-primary"></i>
            <span class="link-text ml-3">Settings</span>
          </a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="content-area flex-1 p-6 overflow-auto">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
          <h1 class="text-2xl font-bold mb-6">Dashboard</h1>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Students Card -->
            <div class="glassmorphic p-6 float-card">
              <div class="flex justify-between items-center">
                <div>
                  <p class="text-sm text-gray-500 font-medium">Total Students</p>
                  <h3 class="text-2xl font-bold text-gray-800" id="totalStudentsCount">
                    <span class="loading-placeholder">Loading...</span>
                  </h3>
                </div>
                <div class="rounded-full bg-blue-100 p-3">
                  <i class="fas fa-user-graduate text-primary text-xl"></i>
                </div>
              </div>
              <div class="mt-4 text-sm text-green-600">
                <i class="fas fa-arrow-up"></i> <span>4%</span> from last term
              </div>
            </div>
            
            <!-- Total Fees Collected Card -->
            <div class="glassmorphic p-6 float-card">
              <div class="flex justify-between items-center">
                <div>
                  <p class="text-sm text-gray-500 font-medium">Fees Collected</p>
                  <h3 class="text-2xl font-bold text-gray-800" id="feesCollectedAmount">
                    <span class="loading-placeholder">Loading...</span>
                  </h3>
                </div>
                <div class="rounded-full bg-green-100 p-3">
                  <i class="fas fa-money-bill-wave text-green-600 text-xl"></i>
                </div>
              </div>
              <div class="mt-4 text-sm text-green-600">
                <i class="fas fa-arrow-up"></i> <span>8%</span> from last term
              </div>
            </div>
            
            <!-- Outstanding Balances Card -->
            <div class="glassmorphic p-6 float-card">
              <div class="flex justify-between items-center">
                <div>
                  <p class="text-sm text-gray-500 font-medium">Outstanding Balances</p>
                  <h3 class="text-2xl font-bold text-gray-800" id="outstandingBalancesAmount">
                    <span class="loading-placeholder">Loading...</span>
                  </h3>
                </div>
                <div class="rounded-full bg-red-100 p-3">
                  <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                </div>
              </div>
              <div class="mt-4 text-sm text-red-600">
                <i class="fas fa-arrow-up"></i> <span>2%</span> from last term
              </div>
            </div>
            
            <!-- Classes Card -->
            <div class="glassmorphic p-6 float-card">
              <div class="flex justify-between items-center">
                <div>
                  <p class="text-sm text-gray-500 font-medium">Total Classes</p>
                  <h3 class="text-2xl font-bold text-gray-800" id="totalClassesCount">
                    <span class="loading-placeholder">Loading...</span>
                  </h3>
                </div>
                <div class="rounded-full bg-purple-100 p-3">
                  <i class="fas fa-chalkboard text-purple-600 text-xl"></i>
                </div>
              </div>
              <div class="mt-4 text-sm text-gray-600">
                <span>3 active teachers</span>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Students per Class Chart -->
            <div class="glassmorphic p-6 float-card">
              <h3 class="text-lg font-semibold mb-4">Students per Class</h3>
              <div class="h-64">
                <canvas id="studentsPerClassChart"></canvas>
              </div>
            </div>
            
            <!-- Fee Collection Trend Chart -->
            <div class="glassmorphic p-6 float-card">
              <h3 class="text-lg font-semibold mb-4">Fee Collection Trend</h3>
              <div class="h-64">
                <canvas id="feeCollectionChart"></canvas>
              </div>
            </div>
          </div>
          
          <div class="mt-8 glassmorphic p-6 float-card">
            <h3 class="text-lg font-semibold mb-4">Recent Activities</h3>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead>
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Activity</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="recentActivitiesList">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap" colspan="3">
                      <div class="text-center">Loading recent activities...</div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Students Section -->
        <section id="students" class="section hidden">
          <div class="flex flex-col md:flex-row justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">Students</h1>
            <div class="flex mt-4 md:mt-0 space-x-2">
              <button id="addStudentBtn" class="bg-primary hover:bg-blue-700 text-white py-2 px-4 rounded flex items-center">
                <i class="fas fa-plus mr-2"></i> Add Student
              </button>
              <button id="importStudentsBtn" class="bg-secondary hover:bg-blue-600 text-white py-2 px-4 rounded flex items-center">
                <i class="fas fa-file-import mr-2"></i> Import CSV
              </button>
            </div>
          </div>
          
          <div class="glassmorphic mb-6 p-4 flex flex-col md:flex-row justify-between items-center">
            <div class="flex flex-col md:flex-row md:space-x-4 w-full md:w-auto mb-4 md:mb-0">
              <div class="w-full md:w-64 mb-3 md:mb-0">
                <input type="text" id="studentSearchInput" placeholder="Search students..." class="w-full p-2 border rounded-md">
              </div>
              <div class="w-full md:w-48">
                <select id="classFilter" class="w-full p-2 border rounded-md">
                  <option value="">All Classes</option>
                  <option value="Form 1">Form 1</option>
                  <option value="Form 2">Form 2</option>
                  <option value="Form 3">Form 3</option>
                </select>
              </div>
            </div>
            <div class="flex items-center space-x-2">
              <span class="text-sm text-gray-600">Show:</span>
              <select id="studentsPerPage" class="p-2 border rounded-md">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
          </div>
          
          <div class="glassmorphic overflow-hidden">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead>
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Full Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Admission #</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gender</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Class</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Guardian</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Address</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="studentsList">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap" colspan="8">
                      <div class="flex justify-center">
                        <div class="loader"></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
              <div class="flex-1 flex justify-between sm:hidden">
                <button class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                  Previous
                </button>
                <button class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                  Next
                </button>
              </div>
              <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                  <p class="text-sm text-gray-700">
                    Showing <span class="font-medium">1</span> to <span class="font-medium">10</span> of <span class="font-medium">97</span> results
                  </p>
                </div>
                <div>
                  <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                    <button class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                      <span class="sr-only">Previous</span>
                      <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="bg-primary border-primary text-white relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                      1
                    </button>
                    <button class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                      2
                    </button>
                    <button class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 hidden md:inline-flex relative items-center px-4 py-2 border text-sm font-medium">
                      3
                    </button>
                    <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                      ...
                    </span>
                    <button class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 hidden md:inline-flex relative items-center px-4 py-2 border text-sm font-medium">
                      10
                    </button>
                    <button class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                      <span class="sr-only">Next</span>
                      <i class="fas fa-chevron-right"></i>
                    </button>
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Classes Section -->
        <section id="classes" class="section hidden">
          <div class="flex flex-col md:flex-row justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">Classes</h1>
            <div class="flex mt-4 md:mt-0 space-x-2">
              <button id="addClassBtn" class="bg-primary hover:bg-blue-700 text-white py-2 px-4 rounded flex items-center">
                <i class="fas fa-plus mr-2"></i> Add Class
              </button>
              <button id="importClassesBtn" class="bg-secondary hover:bg-blue-600 text-white py-2 px-4 rounded flex items-center">
                <i class="fas fa-file-import mr-2"></i> Import CSV
              </button>
            </div>
          </div>
          
          <div class="glassmorphic mb-6 p-4 flex flex-col md:flex-row justify-between items-center">
            <div class="w-full md:w-64 mb-4 md:mb-0">
              <input type="text" id="classSearchInput" placeholder="Search classes..." class="w-full p-2 border rounded-md">
            </div>
          </div>
          
          <div class="glassmorphic overflow-hidden">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead>
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Class Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Class Code</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Teacher</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Students</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="classesList">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap" colspan="5">
                      <div class="flex justify-center">
                        <div class="loader"></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Class Detail Modal (Hidden by default) -->
          <div id="classDetailModal" class="modal fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
            <div class="glassmorphic p-8 w-full max-w-3xl">
              <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-primary" id="classDetailTitle">Class Details</h3>
                <button class="closeModal text-gray-500 hover:text-gray-700">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <div id="classDetailContent">
                <div class="mb-4">
                  <p class="text-sm text-gray-500">Class Code</p>
                  <p class="font-semibold" id="classDetailCode">F1-A</p>
                </div>
                <div class="mb-4">
                  <p class="text-sm text-gray-500">Teacher</p>
                  <p class="font-semibold" id="classDetailTeacher">John Doe</p>
                </div>
                
                <h4 class="font-bold text-lg mb-3 mt-6">Students in this class</h4>
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                      <tr>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Adm #</th>
                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gender</th>
                      </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="classStudentsList">
                      <tr>
                        <td colspan="3" class="px-4 py-2 text-center">Loading students...</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Billing Section -->
        <section id="billing" class="section hidden">
          <div class="flex flex-col md:flex-row justify-between items-center mb-6">
            <h1 class="text-2xl font-bold">Billing</h1>
            <div class="flex mt-4 md:mt-0 space-x-2">
              <button id="createBillBtn" class="bg-primary hover:bg-blue-700 text-white py-2 px-4 rounded flex items-center">
                <i class="fas fa-plus mr-2"></i> Create Bill
              </button>
            </div>
          </div>
          
          <div class="glassmorphic mb-6 p-4 flex flex-col md:flex-row justify-between items-center">
            <div class="flex flex-col md:flex-row md:space-x-4 w-full md:w-auto mb-4 md:mb-0">
              <div class="w-full md:w-64 mb-3 md:mb-0">
                <input type="text" id="billingSearchInput" placeholder="Search by student name or #..." class="w-full p-2 border rounded-md">
              </div>
              <div class="w-full md:w-48">
                <select id="billingStatusFilter" class="w-full p-2 border rounded-md">
                  <option value="">All Status</option>
                  <option value="paid">Fully Paid</option>
                  <option value="partial">Partially Paid</option>
                  <option value="unpaid">Unpaid</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="glassmorphic overflow-hidden">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead>
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bill ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount Due</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount Paid</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Balance</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="billingList">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap" colspan="8">
                      <div class="flex justify-center">
                        <div class="loader"></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
              <div class="flex-1 flex justify-between sm:hidden">
                <button class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                  Previous
                </button>
                <button class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                  Next
                </button>
              </div>
              <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                  <p class="text-sm text-gray-700">
                    Showing <span class="font-medium">1</span> to <span class="font-medium">10</span> of <span class="font-medium">32</span> results
                  </p>
                </div>
                <div>
                  <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                    <button class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                      <span class="sr-only">Previous</span>
                      <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="bg-primary border-primary text-white relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                      1
                    </button>
                    <button class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                      2
                    </button>
                    <button class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 hidden md:inline-flex relative items-center px-4 py-2 border text-sm font-medium">
                      3
                    </button>
                    <button class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 hidden md:inline-flex relative items-center px-4 py-2 border text-sm font-medium">
                      4
                    </button>
                    <button class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                      <span class="sr-only">Next</span>
                      <i class="fas fa-chevron-right"></i>
                    </button>
                  </nav>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Reports Section -->
        <section id="reports" class="section hidden">
          <h1 class="text-2xl font-bold mb-6">Reports</h1>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="glassmorphic p-6 float-card">
              <h3 class="text-lg font-semibold mb-4">Student Reports</h3>
              <p class="text-gray-600 mb-6">Generate a comprehensive list of all students or filter by class.</p>
              
              <form id="studentReportForm" class="space-y-4">
                <div>
                  <label for="studentReportClass" class="block text-sm font-medium text-gray-700 mb-1">Class</label>
                  <select id="studentReportClass" class="w-full p-2 border rounded-md">
                    <option value="">All Classes</option>
                    <option value="Form 1">Form 1</option>
                    <option value="Form 2">Form 2</option>
                    <option value="Form 3">Form 3</option>
                  </select>
                </div>
                
                <div>
                  <label for="studentReportFormat" class="block text-sm font-medium text-gray-700 mb-1">Format</label>
                  <select id="studentReportFormat" class="w-full p-2 border rounded-md">
                    <option value="pdf">PDF</option>
                    <option value="csv">CSV</option>
                  </select>
                </div>
                
                <div>
                  <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                    Generate Report
                  </button>
                </div>
              </form>
            </div>
            
            <div class="glassmorphic p-6 float-card">
              <h3 class="text-lg font-semibold mb-4">Billing Reports</h3>
              <p class="text-gray-600 mb-6">Generate billing and payment reports for a specific period.</p>
              
              <form id="billingReportForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label for="billingReportStart" class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                    <input type="date" id="billingReportStart" class="w-full p-2 border rounded-md">
                  </div>
                  <div>
                    <label for="billingReportEnd" class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                    <input type="date" id="billingReportEnd" class="w-full p-2 border rounded-md">
                  </div>
                </div>
                
                <div>
                  <label for="billingReportType" class="block text-sm font-medium text-gray-700 mb-1">Report Type</label>
                  <select id="billingReportType" class="w-full p-2 border rounded-md">
                    <option value="all">All Transactions</option>
                    <option value="paid">Paid Invoices</option>
                    <option value="unpaid">Unpaid Invoices</option>
                  </select>
                </div>
                
                <div>
                  <label for="billingReportFormat" class="block text-sm font-medium text-gray-700 mb-1">Format</label>
                  <select id="billingReportFormat" class="w-full p-2 border rounded-md">
                    <option value="pdf">PDF</option>
                    <option value="csv">CSV</option>
                  </select>
                </div>
                
                <div>
                  <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                    Generate Report
                  </button>
                </div>
              </form>
            </div>
          </div>
          
          <div class="glassmorphic p-6 mt-6">
            <h3 class="text-lg font-semibold mb-4">Recent Reports</h3>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead>
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Report Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Generated By</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="recentReportsList">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap" colspan="5">
                      <div class="text-center">No recent reports</div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Notifications Section -->
        <section id="notifications" class="section hidden">
          <h1 class="text-2xl font-bold mb-6">Notifications</h1>
          
          <div class="glassmorphic mb-6 p-4 flex flex-col md:flex-row justify-between items-center">
            <h3 class="text-lg font-semibold">SMS Notifications</h3>
            <button class="bg-primary hover:bg-blue-700 text-white py-1 px-4 rounded flex items-center text-sm">
              <i class="fas fa-sync-alt mr-2"></i> Refresh
            </button>
          </div>
          
          <div class="glassmorphic overflow-hidden mb-8">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead>
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recipient</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Message</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="smsNotificationsList">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap" colspan="4">
                      <div class="text-center">No SMS notifications yet</div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="glassmorphic mb-6 p-4 flex flex-col md:flex-row justify-between items-center">
            <h3 class="text-lg font-semibold">Email Notifications</h3>
            <button class="bg-primary hover:bg-blue-700 text-white py-1 px-4 rounded flex items-center text-sm">
              <i class="fas fa-sync-alt mr-2"></i> Refresh
            </button>
          </div>
          
          <div class="glassmorphic overflow-hidden">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead>
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Recipient</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="emailNotificationsList">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap" colspan="4">
                      <div class="text-center">No email notifications yet</div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section hidden">
          <h1 class="text-2xl font-bold mb-6">Settings</h1>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="glassmorphic p-6 col-span-1 md:col-span-2">
              <h3 class="text-lg font-semibold mb-4">School Information</h3>
              
              <form id="schoolInfoForm" class="space-y-4">
                <div>
                  <label for="schoolName" class="block text-sm font-medium text-gray-700 mb-1">School Name</label>
                  <input type="text" id="schoolName" value="Mount View High School" class="w-full p-2 border rounded-md">
                </div>
                
                <div>
                  <label for="schoolLogo" class="block text-sm font-medium text-gray-700 mb-1">School Logo URL</label>
                  <input type="text" id="schoolLogo" value="https://cdn.pixabay.com/photo/2016/11/07/13/04/yoga-1805784_960_720.png" class="w-full p-2 border rounded-md">
                </div>
                
                <div>
                  <label for="schoolAddress" class="block text-sm font-medium text-gray-700 mb-1">School Address</label>
                  <textarea id="schoolAddress" class="w-full p-2 border rounded-md" rows="3">P.O Box 123, Nairobi, Kenya</textarea>
                </div>
                
                <div>
                  <label for="schoolPhone" class="block text-sm font-medium text-gray-700 mb-1">School Phone</label>
                  <input type="text" id="schoolPhone" value="+254 123 456 789" class="w-full p-2 border rounded-md">
                </div>
                
                <div>
                  <label for="schoolEmail" class="block text-sm font-medium text-gray-700 mb-1">School Email</label>
                  <input type="email" id="schoolEmail" value="info@mountview.ac.ke" class="w-full p-2 border rounded-md">
                </div>
                
                <div>
                  <button type="submit" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                    Save Changes
                  </button>
                </div>
              </form>
            </div>
            
            <div class="glassmorphic p-6">
              <h3 class="text-lg font-semibold mb-4">SMS Settings</h3>
              
              <form id="smsSettingsForm" class="space-y-4">
                <div>
                  <label for="smsSender" class="block text-sm font-medium text-gray-700 mb-1">SMS Sender ID</label>
                  <input type="text" id="smsSender" value="MOUNTVIEW" class="w-full p-2 border rounded-md">
                </div>
                
                <div>
                  <label for="smsApiKey" class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                  <input type="password" id="smsApiKey" value="********" class="w-full p-2 border rounded-md">
                </div>
                
                <div class="flex items-center">
                  <input id="enableSMS" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" checked>
                  <label for="enableSMS" class="ml-2 block text-sm text-gray-900">
                    Enable SMS Notifications
                  </label>
                </div>
                
                <div>
                  <button type="submit" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                    Save Changes
                  </button>
                </div>
              </form>
              
              <div class="border-t border-gray-200 mt-6 pt-6">
                <h3 class="text-lg font-semibold mb-4">Email Settings</h3>
                
                <form id="emailSettingsForm" class="space-y-4">
                  <div>
                    <label for="smtpServer" class="block text-sm font-medium text-gray-700 mb-1">SMTP Server</label>
                    <input type="text" id="smtpServer" value="smtp.sendgrid.net" class="w-full p-2 border rounded-md">
                  </div>
                  
                  <div>
                    <label for="smtpUsername" class="block text-sm font-medium text-gray-700 mb-1">SMTP Username</label>
                    <input type="text" id="smtpUsername" value="apikey" class="w-full p-2 border rounded-md">
                  </div>
                  
                  <div>
                    <label for="smtpPassword" class="block text-sm font-medium text-gray-700 mb-1">SMTP Password</label>
                    <input type="password" id="smtpPassword" value="********" class="w-full p-2 border rounded-md">
                  </div>
                  
                  <div class="flex items-center">
                    <input id="enableEmail" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" checked>
                    <label for="enableEmail" class="ml-2 block text-sm text-gray-900">
                      Enable Email Notifications
                    </label>
                  </div>
                  
                  <div>
                    <button type="submit" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                      Save Changes
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          
          <div class="glassmorphic p-6 mt-6">
            <h3 class="text-lg font-semibold mb-4">User Management</h3>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead>
                  <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="usersList">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap">Admin User</td>
                    <td class="px-6 py-4 whitespace-nowrap">admin@mountview.ac.ke</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                        Admin
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                        Active
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <a href="javascript:void(0)" class="text-primary hover:text-blue-700 mr-3">Edit</a>
                      <a href="javascript:void(0)" class="text-red-600 hover:text-red-900">Reset Password</a>
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap">John Smith</td>
                    <td class="px-6 py-4 whitespace-nowrap">john@mountview.ac.ke</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                        Teacher
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                        Active
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <a href="javascript:void(0)" class="text-primary hover:text-blue-700 mr-3">Edit</a>
                      <a href="javascript:void(0)" class="text-red-600 hover:text-red-900">Reset Password</a>
                    </td>
                  </tr>
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap">Mary Johnson</td>
                    <td class="px-6 py-4 whitespace-nowrap">mary@mountview.ac.ke</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                        Bursar
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                        Active
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <a href="javascript:void(0)" class="text-primary hover:text-blue-700 mr-3">Edit</a>
                      <a href="javascript:void(0)" class="text-red-600 hover:text-red-900">Reset Password</a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="mt-4">
              <button type="button" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
                Add New User
              </button>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Add/Edit Student Modal -->
  <div id="studentModal" class="modal fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
    <div class="glassmorphic p-8 w-full max-w-3xl">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-primary" id="studentModalTitle">Add New Student</h3>
        <button class="closeModal text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="studentForm" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="studentName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
            <input type="text" id="studentName" class="w-full p-2 border rounded-md" required>
          </div>
          
          <div>
            <label for="admissionNumber" class="block text-sm font-medium text-gray-700 mb-1">Admission Number</label>
            <input type="text" id="admissionNumber" class="w-full p-2 border rounded-md" required>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="gender" class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
            <select id="gender" class="w-full p-2 border rounded-md" required>
              <option value="">Select Gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </div>
          
          <div>
            <label for="class" class="block text-sm font-medium text-gray-700 mb-1">Class</label>
            <select id="class" class="w-full p-2 border rounded-md" required>
              <option value="">Select Class</option>
              <option value="Form 1">Form 1</option>
              <option value="Form 2">Form 2</option>
              <option value="Form 3">Form 3</option>
            </select>
          </div>
        </div>
        
        <div>
          <label for="guardianName" class="block text-sm font-medium text-gray-700 mb-1">Guardian Name</label>
          <input type="text" id="guardianName" class="w-full p-2 border rounded-md" required>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="guardianPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
            <input type="tel" id="guardianPhone" class="w-full p-2 border rounded-md" required>
          </div>
          
          <div>
            <label for="guardianEmail" class="block text-sm font-medium text-gray-700 mb-1">Email (Optional)</label>
            <input type="email" id="guardianEmail" class="w-full p-2 border rounded-md">
          </div>
        </div>
        
        <div>
          <label for="address" class="block text-sm font-medium text-gray-700 mb-1">Address</label>
          <textarea id="address" rows="3" class="w-full p-2 border rounded-md" required></textarea>
        </div>
        
        <div class="flex justify-end space-x-3">
          <button type="button" class="closeModal py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
            Cancel
          </button>
          <button type="submit" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
            Save Student
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add/Edit Class Modal -->
  <div id="classModal" class="modal fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
    <div class="glassmorphic p-8 w-full max-w-md">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-primary" id="classModalTitle">Add New Class</h3>
        <button class="closeModal text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="classForm" class="space-y-4">
        <div>
          <label for="className" class="block text-sm font-medium text-gray-700 mb-1">Class Name</label>
          <input type="text" id="className" class="w-full p-2 border rounded-md" required>
        </div>
        
        <div>
          <label for="classCode" class="block text-sm font-medium text-gray-700 mb-1">Class Code</label>
          <input type="text" id="classCode" class="w-full p-2 border rounded-md" required>
        </div>
        
        <div>
          <label for="classTeacher" class="block text-sm font-medium text-gray-700 mb-1">Class Teacher</label>
          <select id="classTeacher" class="w-full p-2 border rounded-md" required>
            <option value="">Select Teacher</option>
            <option value="1">John Smith</option>
            <option value="2">Jane Doe</option>
            <option value="3">Robert Johnson</option>
          </select>
        </div>
        
        <div class="flex justify-end space-x-3">
          <button type="button" class="closeModal py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
            Cancel
          </button>
          <button type="submit" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
            Save Class
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Create Bill Modal -->
  <div id="billModal" class="modal fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
    <div class="glassmorphic p-8 w-full max-w-3xl">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-primary">Create New Bill</h3>
        <button class="closeModal text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="billForm" class="space-y-4">
        <div>
          <label for="billStudent" class="block text-sm font-medium text-gray-700 mb-1">Student</label>
          <select id="billStudent" class="w-full p-2 border rounded-md" required>
            <option value="">Select Student</option>
            <option value="1">John Doe (ADM-001)</option>
            <option value="2">Jane Smith (ADM-002)</option>
            <option value="3">Michael Johnson (ADM-003)</option>
            <option value="4">Sarah Williams (ADM-004)</option>
            <option value="5">Robert Brown (ADM-005)</option>
          </select>
        </div>
        
        <div>
          <label for="billDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
          <input type="text" id="billDescription" placeholder="e.g. Term 1 Fees 2025" class="w-full p-2 border rounded-md" required>
        </div>
        
        <div>
          <label for="billItems" class="block text-sm font-medium text-gray-700 mb-1">Bill Items</label>
          <div id="billItemsContainer" class="space-y-2">
            <div class="bill-item flex space-x-2">
              <input type="text" placeholder="Item description" class="flex-1 p-2 border rounded-md">
              <input type="number" placeholder="Amount" class="w-32 p-2 border rounded-md bill-item-amount">
              <button type="button" class="remove-bill-item text-red-500 px-2">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <button type="button" id="addBillItemBtn" class="mt-2 text-primary hover:text-blue-700 text-sm flex items-center">
            <i class="fas fa-plus mr-1"></i> Add Item
          </button>
        </div>
        
        <div class="flex justify-between pt-2 border-t">
          <span class="font-medium">Total Amount:</span>
          <span class="font-bold" id="billTotalAmount">KES 0.00</span>
        </div>
        
        <div>
          <label for="billDueDate" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
          <input type="date" id="billDueDate" class="w-full p-2 border rounded-md" required>
        </div>
        
        <div class="flex items-center">
          <input id="sendSmsNotification" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" checked>
          <label for="sendSmsNotification" class="ml-2 block text-sm text-gray-900">
            Send SMS notification to guardian
          </label>
        </div>
        
        <div class="flex justify-end space-x-3">
          <button type="button" class="closeModal py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
            Cancel
          </button>
          <button type="submit" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
            Create Bill
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Record Payment Modal -->
  <div id="paymentModal" class="modal fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
    <div class="glassmorphic p-8 w-full max-w-md">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-primary">Record Payment</h3>
        <button class="closeModal text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="mb-4 pb-4 border-b">
        <div class="flex justify-between mb-2">
          <span class="text-gray-600">Student:</span>
          <span class="font-semibold" id="paymentStudentName">John Doe</span>
        </div>
        <div class="flex justify-between mb-2">
          <span class="text-gray-600">Bill Amount:</span>
          <span class="font-semibold" id="paymentTotalAmount">KES 45,000</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Outstanding Balance:</span>
          <span class="font-semibold text-red-600" id="paymentOutstandingAmount">KES 25,000</span>
        </div>
      </div>
      
      <form id="paymentForm" class="space-y-4">
        <div>
          <label for="paymentAmount" class="block text-sm font-medium text-gray-700 mb-1">Payment Amount (KES)</label>
          <input type="number" id="paymentAmount" class="w-full p-2 border rounded-md" required>
        </div>
        
        <div>
          <label for="paymentMethod" class="block text-sm font-medium text-gray-700 mb-1">Payment Method</label>
          <select id="paymentMethod" class="w-full p-2 border rounded-md" required>
            <option value="cash">Cash</option>
            <option value="bank_transfer">Bank Transfer</option>
            <option value="mpesa">M-PESA</option>
            <option value="cheque">Cheque</option>
          </select>
        </div>
        
        <div>
          <label for="paymentReference" class="block text-sm font-medium text-gray-700 mb-1">Reference # (Optional)</label>
          <input type="text" id="paymentReference" class="w-full p-2 border rounded-md">
        </div>
        
        <div>
          <label for="paymentDate" class="block text-sm font-medium text-gray-700 mb-1">Payment Date</label>
          <input type="date" id="paymentDate" class="w-full p-2 border rounded-md" required>
        </div>
        
        <div class="flex items-center">
          <input id="sendPaymentSms" type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" checked>
          <label for="sendPaymentSms" class="ml-2 block text-sm text-gray-900">
            Send SMS receipt to guardian
          </label>
        </div>
        
        <div class="flex justify-end space-x-3">
          <button type="button" class="closeModal py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
            Cancel
          </button>
          <button type="submit" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
            Record Payment
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Confirm Delete Modal -->
  <div id="confirmDeleteModal" class="modal fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
    <div class="glassmorphic p-8 w-full max-w-md">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-xl font-bold text-red-600">Confirm Delete</h3>
        <button class="closeModal text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <p class="mb-6 text-gray-700">Are you sure you want to delete this item? This action cannot be undone.</p>
      
      <div class="flex justify-end space-x-3">
        <button type="button" class="closeModal py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
          Cancel
        </button>
        <button type="button" id="confirmDeleteBtn" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
          Delete
        </button>
      </div>
    </div>
  </div>

  <script id="app-script">
    // Application State
    const state = {
      currentUser: null,
      currentSection: 'dashboard',
      sidebarCollapsed: false,
      studentsData: [],
      classesData: [],
      billsData: []
    };
    
    // DOM Elements
    const elements = {
      loginForm: document.getElementById('loginForm'),
      loginModal: document.getElementById('loginModal'),
      appContainer: document.getElementById('appContainer'),
      sidebar: document.getElementById('sidebar'),
      sidebarToggle: document.getElementById('sidebarToggle'),
      sidebarLinks: document.querySelectorAll('.sidebar-link'),
      sections: document.querySelectorAll('.section'),
      userFullName: document.getElementById('userFullName'),
      userRole: document.getElementById('userRole'),
      logoutBtn: document.getElementById('logoutBtn'),
      
      // Dashboard elements
      totalStudentsCount: document.getElementById('totalStudentsCount'),
      feesCollectedAmount: document.getElementById('feesCollectedAmount'),
      outstandingBalancesAmount: document.getElementById('outstandingBalancesAmount'),
      totalClassesCount: document.getElementById('totalClassesCount'),
      studentsPerClassChart: document.getElementById('studentsPerClassChart'),
      feeCollectionChart: document.getElementById('feeCollectionChart'),
      
      // Student section elements
      addStudentBtn: document.getElementById('addStudentBtn'),
      studentModal: document.getElementById('studentModal'),
      studentForm: document.getElementById('studentForm'),
      
      // Class section elements
      addClassBtn: document.getElementById('addClassBtn'),
      classModal: document.getElementById('classModal'),
      classForm: document.getElementById('classForm'),
      
      // Billing section elements
      createBillBtn: document.getElementById('createBillBtn'),
      billModal: document.getElementById('billModal'),
      billForm: document.getElementById('billForm'),
      
      // Payment modal elements
      paymentModal: document.getElementById('paymentModal'),
      paymentForm: document.getElementById('paymentForm'),
      
      // Confirm Delete Modal
      confirmDeleteModal: document.getElementById('confirmDeleteModal'),
      confirmDeleteBtn: document.getElementById('confirmDeleteBtn')
    };
    
    // Initialize Toasts
    const toasts = {
      success: document.getElementById('successToast'),
      successMessage: document.getElementById('successToastMessage'),
      error: document.getElementById('errorToast'),
      errorMessage: document.getElementById('errorToastMessage'),
      
      showSuccess: function(message) {
        this.successMessage.textContent = message;
        this.success.classList.add('show');
        setTimeout(() => {
          this.success.classList.remove('show');
        }, 3000);
      },
      
      showError: function(message) {
        this.errorMessage.textContent = message;
        this.error.classList.add('show');
        setTimeout(() => {
          this.error.classList.remove('show');
        }, 3000);
      }
    };
    
    // Fake API functions (these would be replaced with real API calls)
    const api = {
      login: async (email, password) => {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            if (email === 'admin@mountview.ac.ke' && password === 'admin123') {
              resolve({
                success: true,
                user: {
                  id: 1,
                  name: 'Administrator',
                  email: 'admin@mountview.ac.ke',
                  role: 'Admin'
                }
              });
            } else {
              reject({
                success: false,
                message: 'Invalid email or password'
              });
            }
          }, 1000);
        });
      },
      
      getDashboardStats: async () => {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({
              totalStudents: 97,
              feesCollected: 'KES 3,450,000',
              outstandingBalances: 'KES 1,250,000',
              totalClasses: 8
            });
          }, 1000);
        });
      },
      
      getStudents: async () => {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve([
              { id: 1, name: 'John Doe', admissionNumber: 'ADM-001', gender: 'Male', class: 'Form 1', guardian: 'Jane Doe', phone: '+254 712 345 678', address: 'Nairobi, Kenya' },
              { id: 2, name: 'Mary Smith', admissionNumber: 'ADM-002', gender: 'Female', class: 'Form 2', guardian: 'Robert Smith', phone: '+254 723 456 789', address: 'Mombasa, Kenya' },
              { id: 3, name: 'James Brown', admissionNumber: 'ADM-003', gender: 'Male', class: 'Form 3', guardian: 'Sarah Brown', phone: '+254 734 567 890', address: 'Nakuru, Kenya' },
              { id: 4, name: 'Lucy Johnson', admissionNumber: 'ADM-004', gender: 'Female', class: 'Form 1', guardian: 'Michael Johnson', phone: '+254 745 678 901', address: 'Kisumu, Kenya' },
              { id: 5, name: 'David Williams', admissionNumber: 'ADM-005', gender: 'Male', class: 'Form 2', guardian: 'Elizabeth Williams', phone: '+254 756 789 012', address: 'Eldoret, Kenya' }
            ]);
          }, 1000);
        });
      },
      
      getClasses: async () => {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve([
              { id: 1, name: 'Form 1 East', code: 'F1E', teacher: 'John Smith', students: 32 },
              { id: 2, name: 'Form 2 West', code: 'F2W', teacher: 'Jane Doe', students: 35 },
              { id: 3, name: 'Form 3 North', code: 'F3N', teacher: 'Robert Johnson', students: 30 }
            ]);
          }, 1000);
        });
      },
      
      getBills: async () => {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve([
              { id: 1, student: 'John Doe', billId: 'BILL-2025-001', amountDue: 45000, amountPaid: 20000, balance: 25000, date: '2025-01-15', status: 'partial' },
              { id: 2, student: 'Mary Smith', billId: 'BILL-2025-002', amountDue: 45000, amountPaid: 45000, balance: 0, date: '2025-01-16', status: 'paid' },
              { id: 3, student: 'James Brown', billId: 'BILL-2025-003', amountDue: 45000, amountPaid: 0, balance: 45000, date: '2025-01-17', status: 'unpaid' }
            ]);
          }, 1000);
        });
      }
    };
    
    // UI Controller functions
    const uiController = {
      showSection: function(sectionId) {
        // Hide all sections
        elements.sections.forEach(section => {
          section.classList.add('hidden');
        });
        
        // Show the selected section
        const section = document.getElementById(sectionId);
        if (section) {
          section.classList.remove('hidden');
          section.classList.add('active');
        }
        
        // Update active link
        elements.sidebarLinks.forEach(link => {
          link.classList.remove('active');
          if (link.dataset.section === sectionId) {
            link.classList.add('active');
          }
        });
        
        // Update state
        state.currentSection = sectionId;
      },
      
      toggleSidebar: function() {
        elements.sidebar.classList.toggle('collapsed');
        state.sidebarCollapsed = !state.sidebarCollapsed;
      },
      
      updateDashboard: async function() {
        try {
          const stats = await api.getDashboardStats();
          
          // Update stats
          elements.totalStudentsCount.textContent = stats.totalStudents;
          elements.feesCollectedAmount.textContent = stats.feesCollected;
          elements.outstandingBalancesAmount.textContent = stats.outstandingBalances;
          elements.totalClassesCount.textContent = stats.totalClasses;
          
          // Initialize charts
          this.initializeCharts();
          
        } catch (error) {
          console.error('Error fetching dashboard stats:', error);
          toasts.showError('Failed to load dashboard data');
        }
      },
      
      initializeCharts: function() {
        // Students per Class Chart
        new Chart(elements.studentsPerClassChart, {
          type: 'bar',
          data: {
            labels: ['Form 1 East', 'Form 1 West', 'Form 2 East', 'Form 2 West', 'Form 3 East', 'Form 3 West', 'Form 4 East', 'Form 4 West'],
            datasets: [{
              label: 'Students',
              data: [32, 28, 35, 33, 30, 31, 25, 27],
              backgroundColor: [
                'rgba(0, 70, 184, 0.7)',
                'rgba(0, 70, 184, 0.6)',
                'rgba(75, 131, 219, 0.7)',
                'rgba(75, 131, 219, 0.6)',
                'rgba(0, 70, 184, 0.7)',
                'rgba(0, 70, 184, 0.6)',
                'rgba(75, 131, 219, 0.7)',
                'rgba(75, 131, 219, 0.6)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
        
        // Fee Collection Chart
        new Chart(elements.feeCollectionChart, {
          type: 'line',
          data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
              label: 'Fees Collected (KES)',
              data: [1200000, 450000, 320000, 550000, 690000, 240000],
              backgroundColor: 'rgba(75, 131, 219, 0.2)',
              borderColor: 'rgba(0, 70, 184, 1)',
              borderWidth: 2,
              tension: 0.2,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false
          }
        });
      },
      
      loadStudents: async function() {
        const studentsList = document.getElementById('studentsList');
        
        try {
          // Show loading indicator
          studentsList.innerHTML = `
            <tr>
              <td class="px-6 py-4 whitespace-nowrap" colspan="8">
                <div class="flex justify-center">
                  <div class="loader"></div>
                </div>
              </td>
            </tr>
          `;
          
          // Fetch students data
          const students = await api.getStudents();
          state.studentsData = students;
          
          // Update the UI with the fetched data
          if (students.length === 0) {
            studentsList.innerHTML = `
              <tr>
                <td class="px-6 py-4 whitespace-nowrap" colspan="8">
                  <div class="text-center">No students found</div>
                </td>
              </tr>
            `;
          } else {
            let html = '';
            students.forEach(student => {
              html += `
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap">${student.name}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${student.admissionNumber}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${student.gender}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${student.class}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${student.guardian}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${student.phone}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${student.address}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button class="text-primary hover:text-blue-700 mr-2 edit-student" data-id="${student.id}">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="text-red-600 hover:text-red-900 delete-student" data-id="${student.id}">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              `;
            });
            studentsList.innerHTML = html;
            
            // Add event listeners to the edit and delete buttons
            document.querySelectorAll('.edit-student').forEach(button => {
              button.addEventListener('click', () => {
                const studentId = parseInt(button.dataset.id);
                const student = state.studentsData.find(s => s.id === studentId);
                if (student) {
                  this.showEditStudentModal(student);
                }
              });
            });
            
            document.querySelectorAll('.delete-student').forEach(button => {
              button.addEventListener('click', () => {
                const studentId = parseInt(button.dataset.id);
                const student = state.studentsData.find(s => s.id === studentId);
                if (student) {
                  this.showDeleteConfirmation('student', student.id, student.name);
                }
              });
            });
          }
        } catch (error) {
          console.error('Error loading students:', error);
          studentsList.innerHTML = `
            <tr>
              <td class="px-6 py-4 whitespace-nowrap" colspan="8">
                <div class="text-center text-red-600">Failed to load students. Please try again.</div>
              </td>
            </tr>
          `;
          toasts.showError('Failed to load students data');
        }
      },
      
      loadClasses: async function() {
        const classesList = document.getElementById('classesList');
        
        try {
          // Show loading indicator
          classesList.innerHTML = `
            <tr>
              <td class="px-6 py-4 whitespace-nowrap" colspan="5">
                <div class="flex justify-center">
                  <div class="loader"></div>
                </div>
              </td>
            </tr>
          `;
          
          // Fetch classes data
          const classes = await api.getClasses();
          state.classesData = classes;
          
          // Update the UI with the fetched data
          if (classes.length === 0) {
            classesList.innerHTML = `
              <tr>
                <td class="px-6 py-4 whitespace-nowrap" colspan="5">
                  <div class="text-center">No classes found</div>
                </td>
              </tr>
            `;
          } else {
            let html = '';
            classes.forEach(classItem => {
              html += `
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap">${classItem.name}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${classItem.code}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${classItem.teacher}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${classItem.students}</td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button class="text-blue-600 hover:text-blue-900 mr-2 view-class" data-id="${classItem.id}">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="text-primary hover:text-blue-700 mr-2 edit-class" data-id="${classItem.id}">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="text-red-600 hover:text-red-900 delete-class" data-id="${classItem.id}">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              `;
            });
            classesList.innerHTML = html;
            
            // Add event listeners
            document.querySelectorAll('.view-class').forEach(button => {
              button.addEventListener('click', () => {
                const classId = parseInt(button.dataset.id);
                const classItem = state.classesData.find(c => c.id === classId);
                if (classItem) {
                  this.showClassDetails(classItem);
                }
              });
            });
            
            document.querySelectorAll('.edit-class').forEach(button => {
              button.addEventListener('click', () => {
                const classId = parseInt(button.dataset.id);
                const classItem = state.classesData.find(c => c.id === classId);
                if (classItem) {
                  this.showEditClassModal(classItem);
                }
              });
            });
            
            document.querySelectorAll('.delete-class').forEach(button => {
              button.addEventListener('click', () => {
                const classId = parseInt(button.dataset.id);
                const classItem = state.classesData.find(c => c.id === classId);
                if (classItem) {
                  this.showDeleteConfirmation('class', classItem.id, classItem.name);
                }
              });
            });
          }
        } catch (error) {
          console.error('Error loading classes:', error);
          classesList.innerHTML = `
            <tr>
              <td class="px-6 py-4 whitespace-nowrap" colspan="5">
                <div class="text-center text-red-600">Failed to load classes. Please try again.</div>
              </td>
            </tr>
          `;
          toasts.showError('Failed to load classes data');
        }
      },
      
      loadBills: async function() {
        const billingList = document.getElementById('billingList');
        
        try {
          // Show loading indicator
          billingList.innerHTML = `
            <tr>
              <td class="px-6 py-4 whitespace-nowrap" colspan="8">
                <div class="flex justify-center">
                  <div class="loader"></div>
                </div>
              </td>
            </tr>
          `;
          
          // Fetch billing data
          const bills = await api.getBills();
          state.billsData = bills;
          
          // Update the UI with the fetched data
          if (bills.length === 0) {
            billingList.innerHTML = `
              <tr>
                <td class="px-6 py-4 whitespace-nowrap" colspan="8">
                  <div class="text-center">No bills found</div>
                </td>
              </tr>
            `;
          } else {
            let html = '';
            bills.forEach(bill => {
              // Determine status badge color
              let statusBadgeClass = '';
              if (bill.status === 'paid') {
                statusBadgeClass = 'bg-green-100 text-green-800';
              } else if (bill.status === 'partial') {
                statusBadgeClass = 'bg-yellow-100 text-yellow-800';
              } else {
                statusBadgeClass = 'bg-red-100 text-red-800';
              }
              
              // Format the status text
              let statusText = bill.status.charAt(0).toUpperCase() + bill.status.slice(1);
              
              html += `
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap">${bill.student}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${bill.billId}</td>
                  <td class="px-6 py-4 whitespace-nowrap">KES ${bill.amountDue.toLocaleString()}</td>
                  <td class="px-6 py-4 whitespace-nowrap">KES ${bill.amountPaid.toLocaleString()}</td>
                  <td class="px-6 py-4 whitespace-nowrap">KES ${bill.balance.toLocaleString()}</td>
                  <td class="px-6 py-4 whitespace-nowrap">${bill.date}</td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusBadgeClass}">
                      ${statusText}
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <button class="text-blue-600 hover:text-blue-900 mr-2 view-bill" data-id="${bill.id}">
                      <i class="fas fa-file-pdf"></i>
                    </button>
                    <button class="text-green-600 hover:text-green-900 mr-2 record-payment" data-id="${bill.id}">
                      <i class="fas fa-money-bill-wave"></i>
                    </button>
                    <button class="text-red-600 hover:text-red-900 delete-bill" data-id="${bill.id}">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              `;
            });
            billingList.innerHTML = html;
            
            // Add event listeners
            document.querySelectorAll('.view-bill').forEach(button => {
              button.addEventListener('click', () => {
                const billId = parseInt(button.dataset.id);
                this.viewBillPdf(billId);
              });
            });
            
            document.querySelectorAll('.record-payment').forEach(button => {
              button.addEventListener('click', () => {
                const billId = parseInt(button.dataset.id);
                const bill = state.billsData.find(b => b.id === billId);
                if (bill) {
                  this.showPaymentModal(bill);
                }
              });
            });
            
            document.querySelectorAll('.delete-bill').forEach(button => {
              button.addEventListener('click', () => {
                const billId = parseInt(button.dataset.id);
                const bill = state.billsData.find(b => b.id === billId);
                if (bill) {
                  this.showDeleteConfirmation('bill', bill.id, bill.billId);
                }
              });
            });
          }
        } catch (error) {
          console.error('Error loading bills:', error);
          billingList.innerHTML = `
            <tr>
              <td class="px-6 py-4 whitespace-nowrap" colspan="8">
                <div class="text-center text-red-600">Failed to load billing data. Please try again.</div>
              </td>
            </tr>
          `;
          toasts.showError('Failed to load billing data');
        }
      },
      
      showStudentModal: function(mode = 'add', student = null) {
        const modal = elements.studentModal;
        const title = document.getElementById('studentModalTitle');
        const form = elements.studentForm;
        
        // Set modal title
        title.textContent = mode === 'add' ? 'Add New Student' : 'Edit Student';
        
        // Reset form
        form.reset();
        
        // Fill form with student data if in edit mode
        if (mode === 'edit' && student) {
          document.getElementById('studentName').value = student.name;
          document.getElementById('admissionNumber').value = student.admissionNumber;
          document.getElementById('gender').value = student.gender.toLowerCase();
          document.getElementById('class').value = student.class;
          document.getElementById('guardianName').value = student.guardian;
          document.getElementById('guardianPhone').value = student.phone;
          document.getElementById('address').value = student.address;
        }
        
        // Show modal
        modal.classList.remove('hidden');
        modal.classList.add('show');
      },
      
      showEditStudentModal: function(student) {
        this.showStudentModal('edit', student);
      },
      
      showClassModal: function(mode = 'add', classItem = null) {
        const modal = elements.classModal;
        const title = document.getElementById('classModalTitle');
        const form = elements.classForm;
        
        // Set modal title
        title.textContent = mode === 'add' ? 'Add New Class' : 'Edit Class';
        
        // Reset form
        form.reset();
        
        // Fill form with class data if in edit mode
        if (mode === 'edit' && classItem) {
          document.getElementById('className').value = classItem.name;
          document.getElementById('classCode').value = classItem.code;
          
          // Find the teacher in the dropdown
          const teacherSelect = document.getElementById('classTeacher');
          for (let i = 0; i < teacherSelect.options.length; i++) {
            if (teacherSelect.options[i].text === classItem.teacher) {
              teacherSelect.selectedIndex = i;
              break;
            }
          }
        }
        
        // Show modal
        modal.classList.remove('hidden');
        modal.classList.add('show');
      },
      
      showEditClassModal: function(classItem) {
        this.showClassModal('edit', classItem);
      },
      
      showClassDetails: function(classItem) {
        const modal = document.getElementById('classDetailModal');
        const title = document.getElementById('classDetailTitle');
        const code = document.getElementById('classDetailCode');
        const teacher = document.getElementById('classDetailTeacher');
        const studentsList = document.getElementById('classStudentsList');
        
        // Set class details
        title.textContent = classItem.name;
        code.textContent = classItem.code;
        teacher.textContent = classItem.teacher;
        
        // Show loading indicator for students
        studentsList.innerHTML = `
          <tr>
            <td colspan="3" class="px-4 py-2 text-center">Loading students...</td>
          </tr>
        `;
        
        // Simulate loading students for this class
        setTimeout(() => {
          // Generate random students for demo purposes
          const students = state.studentsData.filter(s => s.class === classItem.name.split(' ')[0] + ' ' + classItem.name.split(' ')[1]);
          
          if (students.length === 0) {
            studentsList.innerHTML = `
              <tr>
                <td colspan="3" class="px-4 py-2 text-center">No students in this class</td>
              </tr>
            `;
          } else {
            let html = '';
            students.forEach(student => {
              html += `
                <tr>
                  <td class="px-4 py-2">${student.name}</td>
                  <td class="px-4 py-2">${student.admissionNumber}</td>
                  <td class="px-4 py-2">${student.gender}</td>
                </tr>
              `;
            });
            studentsList.innerHTML = html;
          }
        }, 1000);
        
        // Show modal
        modal.classList.remove('hidden');
        modal.classList.add('show');
      },
      
      showPaymentModal: function(bill) {
        const modal = elements.paymentModal;
        const studentName = document.getElementById('paymentStudentName');
        const totalAmount = document.getElementById('paymentTotalAmount');
        const outstandingAmount = document.getElementById('paymentOutstandingAmount');
        const paymentDate = document.getElementById('paymentDate');
        
        // Set bill details
        studentName.textContent = bill.student;
        totalAmount.textContent = `KES ${bill.amountDue.toLocaleString()}`;
        outstandingAmount.textContent = `KES ${bill.balance.toLocaleString()}`;
        
        // Set today's date as default
        const today = new Date().toISOString().split('T')[0];
        paymentDate.value = today;
        
        // Show modal
        modal.classList.remove('hidden');
        modal.classList.add('show');
      },
      
      showDeleteConfirmation: function(itemType, itemId, itemName) {
        const modal = elements.confirmDeleteModal;
        const confirmBtn = elements.confirmDeleteBtn;
        
        // Set confirm button data
        confirmBtn.dataset.type = itemType;
        confirmBtn.dataset.id = itemId;
        
        // Show modal
        modal.classList.remove('hidden');
        modal.classList.add('show');
      },
      
      closeModal: function(modalElement) {
        modalElement.classList.remove('show');
        modalElement.classList.add('hidden');
      },
      
      viewBillPdf: function(billId) {
        // In a real app, this would generate and open a PDF
        toasts.showSuccess('Generating PDF statement...');
        
        setTimeout(() => {
          window.open('javascript:void(0)', '_blank');
        }, 1500);
      },
      
      logout: function() {
        // Clear user data
        state.currentUser = null;
        
        // Hide app container and show login modal
        elements.appContainer.classList.add('hidden');
        elements.loginModal.classList.remove('hidden');
        elements.loginModal.classList.add('show');
        
        // Reset login form
        elements.loginForm.reset();
      }
    };
    
    // Event handlers
    function setupEventListeners() {
      // Login form submit
      elements.loginForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const loginBtn = elements.loginForm.querySelector('button[type="submit"]');
        const loginBtnText = document.getElementById('loginBtnText');
        const loginBtnLoader = document.getElementById('loginBtnLoader');
        const loginError = document.getElementById('loginError');
        
        // Show loading state
        loginBtn.disabled = true;
        loginBtnText.textContent = 'Signing In...';
        loginBtnLoader.classList.remove('hidden');
        loginError.classList.add('hidden');
        
        try {
          const response = await api.login(email, password);
          
          // Store user data
          state.currentUser = response.user;
          
          // Update UI
          elements.userFullName.textContent = response.user.name;
          elements.userRole.textContent = response.user.role;
          
          // Hide login modal and show app container
          elements.loginModal.classList.remove('show');
          elements.loginModal.classList.add('hidden');
          elements.appContainer.classList.remove('hidden');
          
          // Load dashboard data
          uiController.updateDashboard();
          
        } catch (error) {
          console.error('Login error:', error);
          loginError.classList.remove('hidden');
        } finally {
          // Restore button state
          loginBtn.disabled = false;
          loginBtnText.textContent = 'Sign In';
          loginBtnLoader.classList.add('hidden');
        }
      });
      
      // Logout button
      elements.logoutBtn.addEventListener('click', function() {
        uiController.logout();
      });
      
      // Sidebar toggle
      elements.sidebarToggle.addEventListener('click', function() {
        uiController.toggleSidebar();
      });
      
      // Sidebar navigation links
      elements.sidebarLinks.forEach(link => {
        link.addEventListener('click', function() {
          const sectionId = this.dataset.section;
          uiController.showSection(sectionId);
          
          // Load section-specific data if needed
          if (sectionId === 'students') {
            uiController.loadStudents();
          } else if (sectionId === 'classes') {
            uiController.loadClasses();
          } else if (sectionId === 'billing') {
            uiController.loadBills();
          }
        });
      });
      
      // Close modal buttons
      document.querySelectorAll('.closeModal').forEach(button => {
        button.addEventListener('click', function() {
          const modal = this.closest('.modal');
          uiController.closeModal(modal);
        });
      });
      
      // Add Student button
      elements.addStudentBtn.addEventListener('click', function() {
        uiController.showStudentModal('add');
      });
      
      // Student form submit
      elements.studentForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // In a real app, this would save the student data
        toasts.showSuccess('Student saved successfully');
        
        // Close the modal
        uiController.closeModal(elements.studentModal);
        
        // Refresh students list
        uiController.loadStudents();
      });
      
      // Add Class button
      elements.addClassBtn.addEventListener('click', function() {
        uiController.showClassModal('add');
      });
      
      // Class form submit
      elements.classForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // In a real app, this would save the class data
        toasts.showSuccess('Class saved successfully');
        
        // Close the modal
        uiController.closeModal(elements.classModal);
        
        // Refresh classes list
        uiController.loadClasses();
      });
      
      // Create Bill button
      elements.createBillBtn.addEventListener('click', function() {
        // Show bill modal
        elements.billModal.classList.remove('hidden');
        elements.billModal.classList.add('show');
      });
      
      // Add Bill Item button
      document.getElementById('addBillItemBtn').addEventListener('click', function() {
        const container = document.getElementById('billItemsContainer');
        const newItem = document.createElement('div');
        newItem.classList.add('bill-item', 'flex', 'space-x-2');
        newItem.innerHTML = `
          <input type="text" placeholder="Item description" class="flex-1 p-2 border rounded-md">
          <input type="number" placeholder="Amount" class="w-32 p-2 border rounded-md bill-item-amount">
          <button type="button" class="remove-bill-item text-red-500 px-2">
            <i class="fas fa-times"></i>
          </button>
        `;
        container.appendChild(newItem);
        
        // Add event listener to the remove button
        newItem.querySelector('.remove-bill-item').addEventListener('click', function() {
          container.removeChild(newItem);
          updateBillTotal();
        });
        
        // Add event listener to the amount input
        newItem.querySelector('.bill-item-amount').addEventListener('input', updateBillTotal);
      });
      
      // Bill form submit
      elements.billForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // In a real app, this would save the bill data
        toasts.showSuccess('Bill created successfully');
        
        // Close the modal
        uiController.closeModal(elements.billModal);
        
        // Refresh bills list
        uiController.loadBills();
      });
      
      // Payment form submit
      elements.paymentForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // In a real app, this would save the payment data
        toasts.showSuccess('Payment recorded successfully');
        
        // Close the modal
        uiController.closeModal(elements.paymentModal);
        
        // Refresh bills list
        uiController.loadBills();
      });
      
      // Confirm Delete button
      elements.confirmDeleteBtn.addEventListener('click', function() {
        const type = this.dataset.type;
        const id = this.dataset.id;
        
        // In a real app, this would delete the item
        toasts.showSuccess(`${type} deleted successfully`);
        
        // Close the modal
        uiController.closeModal(elements.confirmDeleteModal);
        
        // Refresh the appropriate list
        if (type === 'student') {
          uiController.loadStudents();
        } else if (type === 'class') {
          uiController.loadClasses();
        } else if (type === 'bill') {
          uiController.loadBills();
        }
      });
      
      // Student report form submit
      document.getElementById('studentReportForm').addEventListener('submit', function(e) {
        e.preventDefault();
        toasts.showSuccess('Generating student report...');
        
        setTimeout(() => {
          window.open('javascript:void(0)', '_blank');
        }, 1500);
      });
      
      // Billing report form submit
      document.getElementById('billingReportForm').addEventListener('submit', function(e) {
        e.preventDefault();
        toasts.showSuccess('Generating billing report...');
        
        setTimeout(() => {
          window.open('javascript:void(0)', '_blank');
        }, 1500);
      });
      
      // School info form submit
      document.getElementById('schoolInfoForm').addEventListener('submit', function(e) {
        e.preventDefault();
        toasts.showSuccess('School information updated successfully');
      });
      
      // SMS settings form submit
      document.getElementById('smsSettingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        toasts.showSuccess('SMS settings updated successfully');
      });
      
      // Email settings form submit
      document.getElementById('emailSettingsForm').addEventListener('submit', function(e) {
        e.preventDefault();
        toasts.showSuccess('Email settings updated successfully');
      });
      
      // Handle bill item amounts to update total
      document.addEventListener('input', function(e) {
        if (e.target.classList.contains('bill-item-amount')) {
          updateBillTotal();
        }
      });
    }
    
    // Helper function to update the bill total
    function updateBillTotal() {
      const amountInputs = document.querySelectorAll('.bill-item-amount');
      let total = 0;
      
      amountInputs.forEach(input => {
        const value = parseFloat(input.value) || 0;
        total += value;
      });
      
      document.getElementById('billTotalAmount').textContent = `KES ${total.toLocaleString()}`;
    }
    
    // Initialize the application
    function init() {
      setupEventListeners();
    }
    
    // Run initialization
    document.addEventListener('DOMContentLoaded', init);

    // Global state for logged-in status and data
let isLoggedIn = false;
let isSidebarCollapsed = false;

// Simulated Data (This will be modified by CRUD operations)
let simulatedData = {
    // --- Dashboard Data ---
    totalStudents: 975,
    feesCollected: 452000,
    outstandingBalances: 110500,
    totalClasses: 12,
    studentsPerClass: {
        'Form 1 A': 85, 'Form 1 B': 80, 'Form 2 A': 90, 'Form 2 B': 75,
        'Form 3 A': 95, 'Form 3 B': 88, 'Form 4 A': 70, 'Form 4 B': 65,
        'Form 4 C': 60, 'Form 5 A': 55, 'Form 5 B': 52, 'Form 5 C': 60,
    },
    feeCollectionTrend: [
        { month: 'Jan', amount: 30000 }, { month: 'Feb', amount: 50000 },
        { month: 'Mar', amount: 70000 }, { month: 'Apr', amount: 45000 },
        { month: 'May', amount: 80000 }, { month: 'Jun', amount: 95000 },
        { month: 'Jul', amount: 42000 }, { month: 'Aug', amount: 40000 },
    ],
    recentActivities: [
        { activity: 'Fee payment received from Jane Doe', user: 'Billing Dept', date: '2025-11-18' },
        { activity: 'New student John Smith added to Form 1 A', user: 'Admin', date: '2025-11-18' },
        { activity: 'Class Form 4 B teacher updated to Mrs. Evans', user: 'Admin', date: '2025-11-17' },
        { activity: 'Monthly Report generated', user: 'System', date: '2025-11-17' },
    ],
    // --- Students Data (subset) ---
    students: [
        { id: 1, name: 'Jane Doe', adm: 'MVHS/001/25', gender: 'Female', class: 'Form 3', guardian: 'Mr. A Doe', phone: '555-0101', address: '123 Main St' },
        { id: 2, name: 'John Smith', adm: 'MVHS/002/25', gender: 'Male', class: 'Form 1', guardian: 'Mrs. B Smith', phone: '555-0102', address: '456 Oak Ave' },
        { id: 3, name: 'Emily Brown', adm: 'MVHS/003/25', gender: 'Female', class: 'Form 3', guardian: 'Dr. C Brown', phone: '555-0103', address: '789 Pine Ln' },
        { id: 4, name: 'Michael Johnson', adm: 'MVHS/004/25', gender: 'Male', class: 'Form 1', guardian: 'Ms. D Johnson', phone: '555-0104', address: '101 Elm Rd' },
        { id: 5, name: 'Jessica Williams', adm: 'MVHS/005/25', gender: 'Female', class: 'Form 2', guardian: 'Mr. E Williams', phone: '555-0105', address: '202 Birch Ct' },
        { id: 6, name: 'David Garcia', adm: 'MVHS/006/25', gender: 'Male', class: 'Form 3', guardian: 'Mrs. F Garcia', phone: '555-0106', address: '303 Cedar Dr' },
        { id: 7, name: 'Sarah Miller', adm: 'MVHS/007/25', gender: 'Female', class: 'Form 2', guardian: 'Mr. G Miller', phone: '555-0107', address: '404 Maple Pl' },
        { id: 8, name: 'Robert Davis', adm: 'MVHS/008/25', gender: 'Male', class: 'Form 1', guardian: 'Ms. H Davis', phone: '555-0108', address: '505 Willow Way' },
        { id: 9, name: 'Laura Rodriguez', adm: 'MVHS/009/25', gender: 'Female', class: 'Form 4', guardian: 'Dr. I Rodriguez', phone: '555-0109', address: '606 Aspen Cr' },
        { id: 10, name: 'James Martinez', adm: 'MVHS/010/25', gender: 'Male', class: 'Form 4', guardian: 'Mr. J Martinez', phone: '555-0110', address: '707 Poplar Blvd' },
    ],
    // --- Classes Data ---
    classes: [
        { id: 101, name: 'Form 1 A', code: 'F1-A', teacher: 'Mr. Ken Adams', totalStudents: 85, baseClass: 'Form 1' },
        { id: 102, name: 'Form 1 B', code: 'F1-B', teacher: 'Ms. Lucy Bell', totalStudents: 80, baseClass: 'Form 1' },
        { id: 103, name: 'Form 2 A', code: 'F2-A', teacher: 'Mrs. Janet Cole', totalStudents: 90, baseClass: 'Form 2' },
        { id: 104, name: 'Form 2 B', code: 'F2-B', teacher: 'Mr. Peter Duke', totalStudents: 75, baseClass: 'Form 2' },
        { id: 105, name: 'Form 3 A', code: 'F3-A', teacher: 'Dr. Ella Flynn', totalStudents: 95, baseClass: 'Form 3' },
        { id: 106, name: 'Form 3 B', code: 'F3-B', teacher: 'Mr. Greg Hunt', totalStudents: 88, baseClass: 'Form 3' },
        { id: 107, name: 'Form 4 A', code: 'F4-A', teacher: 'Mrs. Iris Jones', totalStudents: 70, baseClass: 'Form 4' },
        { id: 108, name: 'Form 4 B', code: 'F4-B', teacher: 'Ms. Katie King', totalStudents: 65, baseClass: 'Form 4' },
        { id: 109, name: 'Form 5 A', code: 'F5-A', teacher: 'Mr. Larry Lee', totalStudents: 55, baseClass: 'Form 5' },
        { id: 110, name: 'Form 5 B', code: 'F5-B', teacher: 'Mrs. Mona Nash', totalStudents: 52, baseClass: 'Form 5' },
    ],
    // --- Billing Data (subset) ---
    billing: [
        { id: 1, student: 'Jane Doe', billId: 'INV-001', due: 50000, paid: 50000, balance: 0, date: '2025-10-01', status: 'paid' },
        { id: 2, student: 'John Smith', billId: 'INV-002', due: 50000, paid: 25000, balance: 25000, date: '2025-10-01', status: 'partial' },
        { id: 3, student: 'Emily Brown', billId: 'INV-003', due: 50000, paid: 0, balance: 50000, date: '2025-10-01', status: 'unpaid' },
        { id: 4, student: 'Michael Johnson', billId: 'INV-004', due: 50000, paid: 50000, balance: 0, date: '2025-10-01', status: 'paid' },
        { id: 5, student: 'Jessica Williams', billId: 'INV-005', due: 50000, paid: 30000, balance: 20000, date: '2025-10-01', status: 'partial' },
    ]
};

// --- Utility Functions ---
const formatCurrency = (amount) => {
    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 }).format(amount);
};

const showToast = (id, message) => {
    const toast = document.getElementById(id);
    const msgElement = document.getElementById(`${id}Message`);
    if (msgElement) msgElement.textContent = message;

    toast.classList.remove('hidden');
    toast.classList.add('show');

    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            toast.classList.add('hidden');
        }, 300);
    }, 3000);
};

// --- Login/Logout Functionality ---
const loginForm = document.getElementById('loginForm');
const loginModal = document.getElementById('loginModal');
const appContainer = document.getElementById('appContainer');
const loginBtnText = document.getElementById('loginBtnText');
const loginBtnLoader = document.getElementById('loginBtnLoader');
const loginError = document.getElementById('loginError');
const logoutBtn = document.getElementById('logoutBtn');

const handleLogin = (e) => {
    e.preventDefault();
    loginBtnText.classList.add('hidden');
    loginBtnLoader.classList.remove('hidden');
    loginError.classList.add('hidden');

    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    setTimeout(() => {
        if (email === 'admin@mountview.ac.ke' && password === 'admin123') {
            isLoggedIn = true;
            loginModal.classList.remove('show');
            loginModal.classList.add('hidden');
            appContainer.classList.remove('hidden');
            renderSection('dashboard');
            showToast('successToast', 'Login successful! Welcome, Admin.');
        } else {
            loginError.classList.remove('hidden');
            showToast('errorToast', 'Invalid credentials. Try again.');
        }

        loginBtnText.classList.remove('hidden');
        loginBtnLoader.classList.add('hidden');
    }, 1500);
};

const handleLogout = () => {
    isLoggedIn = false;
    appContainer.classList.add('hidden');
    loginModal.classList.remove('hidden');
    loginModal.classList.add('show');
    showToast('successToast', 'Logged out successfully.');
    document.getElementById('password').value = 'admin123';
};

loginForm.addEventListener('submit', handleLogin);
logoutBtn.addEventListener('click', handleLogout);

// --- Sidebar and Section Toggling ---
const sidebarToggle = document.getElementById('sidebarToggle');
const sidebar = document.getElementById('sidebar');
const sections = document.querySelectorAll('.section');
const sidebarLinks = document.querySelectorAll('.sidebar-link');

const toggleSidebar = () => {
    isSidebarCollapsed = !isSidebarCollapsed;
    sidebar.classList.toggle('collapsed', isSidebarCollapsed);
};

const renderSection = (sectionId) => {
    sections.forEach(section => {
        section.classList.add('hidden');
        if (section.id === sectionId) {
            section.classList.remove('hidden');
        }
    });

    sidebarLinks.forEach(link => {
        link.classList.remove('active');
        if (link.dataset.section === sectionId) {
            link.classList.add('active');
        }
    });

    switch (sectionId) {
        case 'dashboard':
            loadDashboardData();
            break;
        case 'students':
            loadStudentsData();
            break;
        case 'classes':
            loadClassesData();
            break;
        case 'billing':
            loadBillingData();
            break;
    }
};

sidebarToggle.addEventListener('click', toggleSidebar);
sidebarLinks.forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();
        const sectionId = link.dataset.section;
        renderSection(sectionId);
    });
});

// --- Dashboard Functions ---
let studentsPerClassChart;
let feeCollectionChart;

const loadDashboardData = () => {
    document.getElementById('totalStudentsCount').innerHTML = simulatedData.students.length.toLocaleString(); // Use live student count
    document.getElementById('feesCollectedAmount').innerHTML = formatCurrency(simulatedData.feesCollected);
    document.getElementById('outstandingBalancesAmount').innerHTML = formatCurrency(simulatedData.outstandingBalances);
    document.getElementById('totalClassesCount').innerHTML = simulatedData.classes.length;

    renderStudentsPerClassChart();
    renderFeeCollectionChart();
    renderRecentActivities();
};

// ... Chart and Activity rendering functions (omitted for brevity, assume they are the same) ...
const renderStudentsPerClassChart = () => { /* ... same as before ... */ };
const renderFeeCollectionChart = () => { /* ... same as before ... */ };
const renderRecentActivities = () => {
    const list = document.getElementById('recentActivitiesList');
    list.innerHTML = '';
    simulatedData.recentActivities.forEach(activity => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${activity.activity}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${activity.user}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${activity.date}</td>
        `;
        list.appendChild(row);
    });
};


// --- Students Functions (CRUD Implemented) ---
let currentStudents = []; 
let currentPage = 1;
const studentsPerPageControl = document.getElementById('studentsPerPage');
const studentSearchInput = document.getElementById('studentSearchInput');
const classFilter = document.getElementById('classFilter');

const filterStudents = () => {
    const searchTerm = studentSearchInput.value.toLowerCase();
    const classToFilter = classFilter.value;

    return simulatedData.students.filter(student => {
        const nameMatch = student.name.toLowerCase().includes(searchTerm);
        const admMatch = student.adm.toLowerCase().includes(searchTerm);
        const classMatch = !classToFilter || student.class === classToFilter;
        return (nameMatch || admMatch) && classMatch;
    });
};

const loadStudentsData = () => {
    const filteredStudents = filterStudents();
    const list = document.getElementById('studentsList');
    list.innerHTML = ''; 

    if (filteredStudents.length === 0) {
        list.innerHTML = `<tr><td colspan="8" class="px-6 py-4 text-center text-gray-500">No students found matching your criteria.</td></tr>`;
        return;
    }

    const perPage = parseInt(studentsPerPageControl.value);
    const start = (currentPage - 1) * perPage;
    const paginatedStudents = filteredStudents.slice(start, start + perPage);

    paginatedStudents.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">${student.name}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.adm}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.gender}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-primary">${student.class}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.guardian}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.phone}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${student.address}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <button class="text-indigo-600 hover:text-indigo-900 mr-2" onclick="editStudentModal(${student.id})"><i class="fas fa-edit"></i></button>
                <button class="text-red-600 hover:text-red-900" onclick="deleteStudent(${student.id}, '${student.name}')"><i class="fas fa-trash-alt"></i></button>
            </td>
        `;
        list.appendChild(row);
    });
    // Pagination logic would update here
};

/**
 * NEW: Hard deletion of student from the local array
 */
const deleteStudent = (id, name) => {
    if (confirm(`Are you sure you want to permanently delete the record for student: ${name}?`)) {
        // Find index of student to delete
        const initialLength = simulatedData.students.length;
        simulatedData.students = simulatedData.students.filter(student => student.id !== id);
        
        if (simulatedData.students.length < initialLength) {
            showToast('errorToast', `Successfully deleted student: ${name}.`);
            loadStudentsData(); // Reload table after deletion
        } else {
            showToast('errorToast', 'Deletion failed (student not found).');
        }
    }
};


/**
 * NEW: Function to open a modal/prompt for adding a new student
 */
const addStudentModal = () => {
    // In a real app, this would open a modal form.
    const name = prompt("Enter the New Student's Full Name (e.g., Tom Hanks):");
    if (!name) return;

    const classInput = prompt(`Enter the student's Class (e.g., Form 1, Form 2, etc.):`);
    if (!classInput) return;

    // Simulate generating a unique ID and admission number
    const newId = Math.max(...simulatedData.students.map(s => s.id)) + 1;
    const newAdm = `MVHS/${String(newId).padStart(3, '0')}/25`;
    
    const newStudent = {
        id: newId,
        name: name,
        adm: newAdm,
        gender: 'N/A', 
        class: classInput,
        guardian: 'N/A', 
        phone: 'N/A', 
        address: 'N/A'
    };

    // Add student to the local array
    simulatedData.students.push(newStudent);
    
    showToast('successToast', `New Student added: ${name} (${newAdm})!`);
    loadStudentsData(); // Reload table after addition
    renderSection('dashboard'); // Update the dashboard count
};

/**
 * NEW: Function to open a modal/prompt for editing an existing student
 */
const editStudentModal = (id) => {
    const student = simulatedData.students.find(s => s.id === id);
    if (!student) return showToast('errorToast', 'Student not found.');

    const newName = prompt(`Editing ${student.name}. Enter new name:`, student.name);
    if (!newName || newName === student.name) return; // User cancelled or didn't change

    // Update the student object in the local array
    student.name = newName;
    
    showToast('successToast', `${student.adm} updated to: ${newName}`);
    loadStudentsData(); // Reload table after update
};


studentsPerPageControl.addEventListener('change', () => { currentPage = 1; loadStudentsData(); });
studentSearchInput.addEventListener('input', () => { currentPage = 1; loadStudentsData(); });
classFilter.addEventListener('change', () => { currentPage = 1; loadStudentsData(); });

// Attaching the new addStudentModal function
document.getElementById('addStudentBtn').addEventListener('click', addStudentModal);
document.getElementById('importStudentsBtn').addEventListener('click', () => showToast('successToast', 'Opening Import Students Dialog...'));


// --- Classes Functions ---
// ... (omitted for brevity, use the previous logic) ...
const classDetailModal = document.getElementById('classDetailModal');
const closeClassDetailModal = () => {
    classDetailModal.classList.remove('show');
    classDetailModal.classList.add('hidden');
};

document.querySelectorAll('.closeModal').forEach(btn => {
    btn.addEventListener('click', closeClassDetailModal);
});

const loadClassesData = () => {
    const list = document.getElementById('classesList');
    list.innerHTML = ''; 

    simulatedData.classes.forEach(cls => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">${cls.name}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${cls.code}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${cls.teacher}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-primary">${cls.totalStudents}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <button class="text-primary hover:text-blue-700 mr-2" onclick="viewClassDetails(${cls.id})"><i class="fas fa-eye"></i> View</button>
                <button class="text-indigo-600 hover:text-indigo-900 mr-2" onclick="editClass(${cls.id})"><i class="fas fa-edit"></i></button>
                <button class="text-red-600 hover:text-red-900" onclick="deleteClass(${cls.id})"><i class="fas fa-trash-alt"></i></button>
            </td>
        `;
        list.appendChild(row);
    });
};

const viewClassDetails = (id) => {
    const cls = simulatedData.classes.find(c => c.id === id);
    if (!cls) return;

    // Filter students for this class based on the simplified 'class' property in student data
    const studentsInClass = simulatedData.students.filter(s => s.class === cls.baseClass); 

    document.getElementById('classDetailTitle').textContent = `${cls.name} Details`;
    document.getElementById('classDetailCode').textContent = cls.code;
    document.getElementById('classDetailTeacher').textContent = cls.teacher;
    const classStudentsList = document.getElementById('classStudentsList');

    classStudentsList.innerHTML = '';
    if (studentsInClass.length === 0) {
        classStudentsList.innerHTML = `<tr><td colspan="3" class="px-4 py-2 text-center text-gray-500">No students currently assigned to this class.</td></tr>`;
    } else {
        studentsInClass.forEach(student => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${student.name}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">${student.adm}</td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">${student.gender}</td>
            `;
            classStudentsList.appendChild(row);
        });
    }

    classDetailModal.classList.remove('hidden');
    classDetailModal.classList.add('show');
};
const editClass = (id) => showToast('successToast', `Editing Class ID: ${id}`);
const deleteClass = (id) => showToast('errorToast', `Simulated deletion of Class ID: ${id}`);


// --- Billing Functions ---
// ... (omitted for brevity, use the previous logic) ...
const loadBillingData = () => {
    const list = document.getElementById('billingList');
    list.innerHTML = ''; 

    const statusMap = {
        'paid': { text: 'Fully Paid', class: 'bg-green-100 text-green-800' },
        'partial': { text: 'Partial Payment', class: 'bg-yellow-100 text-yellow-800' },
        'unpaid': { text: 'Unpaid', class: 'bg-red-100 text-red-800' }
    };

    simulatedData.billing.forEach(bill => {
        const statusInfo = statusMap[bill.status];
        const row = document.createElement('tr');
        row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">${bill.student}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${bill.billId}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatCurrency(bill.due)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600">${formatCurrency(bill.paid)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold">${formatCurrency(bill.balance)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${bill.date}</td>
            <td class="px-6 py-4 whitespace-nowrap">
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusInfo.class}">${statusInfo.text}</span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <button class="text-primary hover:text-blue-700 mr-2" onclick="recordPayment(${bill.id})"><i class="fas fa-file-invoice"></i> Pay</button>
                <button class="text-indigo-600 hover:text-indigo-900" onclick="downloadInvoice(${bill.id})"><i class="fas fa-download"></i> PDF</button>
            </td>
        `;
        list.appendChild(row);
    });
};

const recordPayment = (id) => showToast('successToast', `Opening payment form for Bill ID: INV-00${id}`);
const downloadInvoice = (id) => {
    showToast('successToast', `Generating PDF for Bill ID: INV-00${id}...`);
    // jsPDF logic remains the same
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const bill = simulatedData.billing.find(b => b.id === id);

    doc.setFontSize(22);
    doc.text("Mount View High School Invoice", 14, 20);
    doc.setFontSize(12);
    doc.text(`Bill ID: ${bill.billId}`, 14, 30);
    doc.text(`Student: ${bill.student}`, 14, 35);
    doc.text(`Date: ${bill.date}`, 14, 40);

    doc.autoTable({
        startY: 50,
        head: [['Description', 'Amount Due', 'Amount Paid', 'Balance']],
        body: [['School Fees (Term 1)', formatCurrency(bill.due), formatCurrency(bill.paid), formatCurrency(bill.balance)]],
        theme: 'striped',
        headStyles: { fillColor: [0, 70, 184] }
    });

    doc.save(`Invoice_${bill.billId}.pdf`);
    showToast('successToast', `PDF downloaded for Bill ID: ${bill.billId}`);
};
document.getElementById('createBillBtn').addEventListener('click', () => showToast('successToast', 'Opening Create New Bill Form...'));

// --- Initial Setup ---
// The app starts with the login modal showing (via the HTML `show` class).
  </script>

</body>
</html>